<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<div th:replace="fragments/navbar :: body"></div>

<head>
    <title>Job Listings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">

    <!-- SUCCESS MESSAGE -->
    <div th:if="${param.applied}" class="alert alert-success text-center">
        Application submitted successfully.
    </div>

    <!-- ALREADY APPLIED -->
    <div th:if="${param.alreadyApplied}" class="alert alert-warning text-center">
        You have already applied for this job.
    </div>

    <div th:if="${#lists.isEmpty(jobs)}" class="alert alert-info text-center">
        No jobs available at the moment. Please check back later.
    </div>

    <form method="get" action="/jobs" class="mb-4">
        <div class="input-group">
            <input type="text"
                   name="keyword"
                   class="form-control"
                   placeholder="Search by job title, company, or location"
                   th:value="${keyword}">
            <button class="btn btn-primary" type="submit">
                Search
            </button>
        </div>
    </form>



    <div class="row">
        <div class="col-md-6 mb-4" th:each="job : ${jobs}">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column">

                    <h5 th:text="${job.title}"></h5>

                    <h6 class="text-muted"
                        th:text="${job.company} + ' â€¢ ' + ${job.location}">
                    </h6>

                    <p class="flex-grow-1" th:text="${job.description}"></p>

                    <!-- APPLY BUTTON ONLY FOR PURE USER -->
                    <div sec:authorize="hasRole('USER') and !hasRole('ADMIN') and !hasRole('RECRUITER')">
                        <form th:action="@{/jobs/apply/{id}(id=${job.id})}" method="post">
                            <button type="submit" class="btn btn-primary w-100">
                                Apply
                            </button>
                        </form>
                    </div>


                </div>
            </div>
        </div>
    </div>

</div>

</body>
</html>
